# Prompt для генерации плана разработки CLI‑утилиты анализа зависимостей Delphi проекта

Ты — Senior Software Architect и эксперт по build-системам.

Нужно спроектировать и подробно описать разработку CLI-утилиты на C#.

Не давай общих советов.  
Нужен конкретный технический план, архитектура и шаги реализации.

---

# Контекст

Есть большой монорепозиторий с множеством приложений на Delphi (Object Pascal).

Особенности:

- десятки проектов
- каждый проект содержит:
  - .dproj
  - .dpr
  - .pas
  - .inc
- проекты могут:
  - подключать юниты через uses
  - include через {$I} / {$INCLUDE}
  - иметь search paths
  - использовать файлы из любых директорий монорепозитория
  - использовать packages

Зависимости могут находиться где угодно в репозитории.

---

# Цель разработки

Создать локальную CLI-утилиту для разработчиков.

⚠️ На первом этапе CI не нужен.

Разработчик запускает:

analyzer.exe path/to/project.dproj

И получает:

- список всех .pas юнитов проекта
- список include файлов
- список всех транзитивных зависимостей
- итоговый dependency list
- JSON файл рядом с проектом (например project.deps.json)

---

# Требования к утилите

- C#
- .NET
- single-file publish
- без внешних зависимостей
- работает быстро
- работает оффлайн
- поддерживает большие проекты

---

# Что приложение должно уметь (базовая логика)

1. Парсить .dproj
2. Извлекать:
   - dpr
   - search paths
   - includes
3. Анализировать:
   - dpr
   - все pas файлы
4. Извлекать:
   - uses
   - {$I}
   - {$INCLUDE}
5. Рекурсивно строить граф зависимостей
6. Формировать:
   - список всех файлов
   - dependency graph
   - JSON

---

# Этапность разработки (обязательно)

## Phase 1 — MVP
- прочитать .dproj
- найти dpr
- распарсить uses
- найти все pas
- построить список зависимостей
- вывести JSON

Без CI, без оптимизаций, без кэша.

Цель: минимально рабочий dependency extractor.

---

## Phase 2 — Optimization
- кэширование анализа
- параллельный парсинг
- быстрый повторный запуск
- incremental анализ
- минимизация IO
- профилирование

---

## Phase 3 — Production
- поддержка changed files
- интеграция с CI
- rebuild detection
- расширяемость
- стабильные форматы
- логирование
- тестирование
- большие монорепозитории
- edge cases Delphi

---

# Твоя задача

Сформируй подробный технический документ, включающий:

## 1. Архитектура
- слои
- модули
- ответственность
- диаграмма компонентов (текстовая)

## 2. Подробный алгоритм анализа
- пошагово
- псевдокод
- как искать файлы
- как резолвить uses

## 3. Структура проекта C#
- папки
- классы
- интерфейсы
- модели

## 4. Форматы данных
- структура dependency graph
- пример JSON

## 5. Парсинг Delphi
- стратегия
- regex или tokenizer
- обработка комментариев
- edge cases

## 6. Реализация по фазам
Для каждой фазы:
- что реализовать
- порядок шагов
- минимальный код
- критерии готовности

## 7. Производительность
- сложность алгоритма
- масштабирование
- оптимизации

## 8. Тестирование
- unit тесты
- примеры проектов
- edge cases

## 9. Примеры запуска
- команды
- примеры вывода

---

Формат ответа:
- структурированный
- технический
- без воды
- с код-блоками и псевдокодом
